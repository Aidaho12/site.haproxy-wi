{% extends "base.html" %}
{% block content %}	
<div style="padding-left: 20px">
	<ul class="link_list">
		<li><a href="settings.py#haproxy_wi_config" title="HAProxy-WI config">HAProxy-WI config</a></li>
		<li><a href="settings.py#haproxy_config" title="HAProxy config">HAProxy config</a></li>
		<li><a href="settings.py#nginx_config" title="Nginx config">Nginx config</a></li>
		<li><a href="settings.py#db_settings" title="DB settings">DB settings</a></li>
		<li><a href="settings.py#apache" title="Apache settings">Apache settings</a></li>
	</ul>
	<a name="haproxy_wi_config"></a>
	<h3><a href="settings.py#haproxy_wi_config" title="HAProxy-WI config">HAProxy-WI config</a></h3>
	<br/>
	Edit $HOME_HAPROXY-WI/app/haproxy-wi.cfg with your env. Default config:
	<div class="code_div">
		<pre>
[main]
#Path to files destination
fullpath = /var/www/haproxy-wi
log_path = ${fullpath}/log/

[configs]
#Dir where configs will be save
haproxy_save_configs_dir = ${main:fullpath}/configs/hap_config/
kp_save_configs_dir = ${main:fullpath}/configs/kp_config/
nginx_save_configs_dir = ${main:fullpath}/configs/nginx_config/

[mysql]
#Enable MySQL DB. Default will be used Sqlite DB. Default disable
enable = 0
mysql_user = haproxy-wi
mysql_password = haproxywi
mysql_db = haproxywi
mysql_host = 127.0.0.1
mysql_port = 3306

		</pre>
	</div>
	
	<a name="haproxy_config"></a>
	<h3><a href="settings.py#haproxy_config" title="HAProxy config">HAProxy config</a></h3>
	<br/>
	If you use installed HAProxy without HAProxy-WI then for Runtime API, Metrics and Alerting enable state file and stat socket on the HAProxy servers and needs install socat to the all haproxy servers, and configre the HAProxy:
	<div class="code_div">
		<pre>
global
    stats socket *:1999 level admin 
    stats socket /var/run/haproxy.sock mode 600 level admin
    server-state-file /etc/haproxy/haproxy.state

defaults
    load-server-state-from-file global

listen stats 
    bind *:8085
    stats enable
    stats uri /stats
    stats realm HAProxy-04\ Statistics
    stats auth admin:password
    stats admin if TRUE 
		</pre>
	</div>
	
	<a name="nginx_config"></a>
	<h3><a href="settings.py#nginx_config" title="Nginx config">Nginx config</a></h3>
	<br/>
	If you use installed Nginx without HAProxy-WI then for view stats you should add the next configuration to all your Nginx servers:
	<div class="code_div">
		<pre>
server {
    listen       8086 ;
    server_name  localhost;

    location /stats {
        stub_status;
        auth_basic           "Resticted Area";
        auth_basic_user_file /etc/nginx/status_page_passwdfile;
    }
}

		</pre>
	</div>
	And generate login/password with htpasswd into /etc/nginx/status_page_passwdfile
	<a name="db_settings"></a>
	<h3><a href="settings.py#db_settings" title="DB settings">DB settings</a></h3>
	<br/>

	Default the HAProxy-WI uses the Sqlite, if you want to use the MySQL enable it in config:
	<div class="code_div">
		<ul>
			<br />
			<li>[mysql]</li>
			<li>#Enable MySQL DB. Default will be used Sqlite DB. Default disable</li>
			<li>enable = 1</li>
			<li>mysql_user = haproxywi</li>
			<li>mysql_password = haproxy-wi</li>
			<li>mysql_db = haproxywi</li>
			<li>mysql_host = 127.0.0.1</li>
			<br />
		</ul>
	</div>
	<br />
	And create a database:
	<div class="code_div">
		<ul>
			<br />
			<li>MariaDB [(none)]> create user 'haproxy-wi'@'%';</li>
			<li>MariaDB [(none)]> create database haproxywi;</li>
			<li>MariaDB [(none)]> grant all on haproxywi.* to 'haproxy-wi'@'%' IDENTIFIED BY 'haproxy-wi';</li>
			<li>MariaDB [(none)]> grant all on haproxywi.* to 'haproxy-wi'@'localhost' IDENTIFIED BY 'haproxy-wi';</li>
			<br />
		</ul>
	</div>
	<a name="apache"></a>
	<h3><a href="settings.py#apache" title="Apache settings">Apache settings</a></h3>
	<br/>
	If you want to use your own Domain name you should edit haproxy-wi.conf for Apache:
	<div class="code_div">
		<pre>
$ sudo vi /etc/httpd/conf.d/haproxy-wi.conf
		</pre>
	</div>
	Edit the next string, replace "haprox-wi.example.com" on your own:
	<div class="code_div">
		<pre>
&lt;VirtualHost my_domain.local:443>
    ...
    ServerName my_domain.local
    ...
&lt;/VirtualHost>
		</pre>
	</div>
	And if you want to have redirect from the port 80 to the port 443, you should add next:
	<div class="code_div">
		<pre>
&lt;VirtualHost demo.haproxy-wi.org:80>
        ServerName demo.haproxy-wi.org
        Redirect permanent / https://demo.haproxy-wi.org

&lt;/VirtualHost>
		</pre>
	</div>
	In order to change the certificates you should edit:
		<div class="code_div">
		<pre>
&lt;VirtualHost my_domain.local:443>
    ...
    SSLEngine on
    SSLCertificateFile /var/www/haproxy-wi/app/certs/haproxy-wi.crt
    SSLCertificateKeyFile /var/www/haproxy-wi/app/certs/haproxy-wi.key
    ...
&lt;/VirtualHost>
		</pre>
	</div>
</div>
{% endblock %}